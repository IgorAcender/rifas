{% extends 'base.html' %}

{% block title %}Dashboard Admin | Sistema de Rifas{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-left">
        <svg class="header-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <h1>Dashboard Administrativo</h1>
    </div>
</div>

<!-- Estatísticas Gerais -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon" style="background: #e0f2fe;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0ea5e9" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
        </div>
        <div class="stat-content">
            <p class="stat-label">Total de Campanhas</p>
            <p class="stat-value">{{ total_campaigns }}</p>
            <p class="stat-detail">{{ active_campaigns }} ativas</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon" style="background: #dcfce7;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        </div>
        <div class="stat-content">
            <p class="stat-label">Total de Compradores</p>
            <p class="stat-value">{{ total_buyers }}</p>
            <p class="stat-detail">Únicos</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon" style="background: #fef3c7;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        </div>
        <div class="stat-content">
            <p class="stat-label">Receita Total</p>
            <p class="stat-value">R$ {{ total_revenue_all|floatformat:2 }}</p>
            <p class="stat-detail">Todas as campanhas</p>
        </div>
    </div>
</div>

<!-- Lista de Campanhas com Estatísticas -->
<div class="campaigns-section">
    <h2 class="section-title">Campanhas Detalhadas</h2>

    {% if campaigns_stats %}
        {% for campaign in campaigns_stats %}
        <div class="campaign-card">
            <div class="campaign-header">
                <div class="campaign-info">
                    <h3 class="campaign-title">{{ campaign.raffle.name }}</h3>
                    <span class="campaign-status status-{{ campaign.raffle.status }}">
                        {{ campaign.raffle.get_status_display }}
                    </span>
                </div>
                <a href="{% url 'campaign_details' campaign.raffle.pk %}" class="btn-view-details">
                    Ver Detalhes
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>

            <div class="campaign-stats-grid">
                <div class="campaign-stat">
                    <p class="stat-label">Números Vendidos</p>
                    <p class="stat-value">{{ campaign.numbers_sold }} / {{ campaign.raffle.total_numbers }}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ campaign.percentage_sold }}%"></div>
                    </div>
                    <p class="stat-detail">{{ campaign.percentage_sold }}% vendidos</p>
                </div>

                <div class="campaign-stat">
                    <p class="stat-label">Disponíveis</p>
                    <p class="stat-value">{{ campaign.numbers_available }}</p>
                    <p class="stat-detail">números</p>
                </div>

                <div class="campaign-stat">
                    <p class="stat-label">Valor Disponível</p>
                    <p class="stat-value">R$ {{ campaign.available_value|floatformat:2 }}</p>
                    <p class="stat-detail">A arrecadar</p>
                </div>

                <div class="campaign-stat">
                    <p class="stat-label">Compradores</p>
                    <p class="stat-value">{{ campaign.unique_buyers }}</p>
                    <p class="stat-detail">únicos</p>
                </div>

                <div class="campaign-stat">
                    <p class="stat-label">Receita Total</p>
                    <p class="stat-value">R$ {{ campaign.total_revenue|floatformat:2 }}</p>
                    <p class="stat-detail">Valor arrecadado</p>
                </div>

                <div class="campaign-stat">
                    <p class="stat-label">Taxa ({{ campaign.raffle.fee_percentage }}%)</p>
                    <p class="stat-value">R$ {{ campaign.fee_amount|floatformat:2 }}</p>
                    <p class="stat-detail">Valor da taxa</p>
                </div>

                <div class="campaign-stat highlight">
                    <p class="stat-label">Receita Líquida</p>
                    <p class="stat-value">R$ {{ campaign.net_revenue|floatformat:2 }}</p>
                    <p class="stat-detail">Após taxas</p>
                </div>

                <div class="campaign-stat">
                    <p class="stat-label">Preço por Número</p>
                    <p class="stat-value">R$ {{ campaign.raffle.price_per_number|floatformat:2 }}</p>
                    <p class="stat-detail">unidade</p>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            <p>Nenhuma campanha cadastrada ainda</p>
            <a href="{% url 'raffle_create' %}" class="btn-primary">Criar primeira campanha</a>
        </div>
    {% endif %}
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
}

.page-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.header-icon {
    color: #335268;
}

.page-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    gap: 16px;
    align-items: flex-start;
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.stat-content {
    flex: 1;
}

.stat-label {
    font-size: 14px;
    color: #64748b;
    margin: 0 0 8px 0;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 4px 0;
}

.stat-detail {
    font-size: 13px;
    color: #94a3b8;
    margin: 0;
}

/* Campaigns Section */
.campaigns-section {
    margin-top: 40px;
}

.section-title {
    font-size: 20px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 20px;
}

.campaign-card {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 20px;
}

.campaign-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #f1f5f9;
}

.campaign-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.campaign-title {
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    margin: 0;
}

.campaign-status {
    padding: 4px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
}

.status-active {
    background: #dcfce7;
    color: #16a34a;
}

.status-draft {
    background: #f3f4f6;
    color: #6b7280;
}

.status-finished {
    background: #dbeafe;
    color: #2563eb;
}

.status-cancelled {
    background: #fee2e2;
    color: #dc2626;
}

.btn-view-details {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: #335268;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s;
}

.btn-view-details:hover {
    background: #2a4456;
}

.campaign-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.campaign-stat {
    padding: 16px;
    background: #f8fafc;
    border-radius: 8px;
}

.campaign-stat.highlight {
    background: #dcfce7;
    border: 1px solid #22c55e;
}

.campaign-stat .stat-label {
    font-size: 13px;
    color: #64748b;
    margin: 0 0 8px 0;
}

.campaign-stat .stat-value {
    font-size: 24px;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 4px 0;
}

.campaign-stat .stat-detail {
    font-size: 12px;
    color: #94a3b8;
    margin: 0;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
    margin: 8px 0 4px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #22c55e, #16a34a);
    transition: width 0.3s ease;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: white;
    border: 2px dashed #e5e7eb;
    border-radius: 12px;
}

.empty-state svg {
    color: #cbd5e1;
    margin-bottom: 16px;
}

.empty-state p {
    font-size: 16px;
    color: #64748b;
    margin-bottom: 20px;
}

.btn-primary {
    display: inline-block;
    padding: 12px 24px;
    background: #335268;
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: background 0.2s;
}

.btn-primary:hover {
    background: #2a4456;
}
</style>
{% endblock %}
