<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{ raffle.name }} - Participe agora!</title>
    <meta name="description" content="{{ raffle.description }}">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #16a34a;
            --secondary-dark: #15803d;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --border-color: #cbd5e1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-light);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            min-height: 100vh;
            padding-bottom: 140px;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: var(--white);
            padding: 40px 20px;
            text-align: center;
        }

        .container {
            max-width: 1200px;
            margin: -30px auto 0;
            padding: 0 20px;
        }

        .main-card, .numbers-section, .share-section {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 24px;
            padding: 32px;
        }

        .prize-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .prize-section {
                grid-template-columns: 1fr;
            }
        }

        .prize-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 12px;
        }

        .prize-info h2 {
            font-size: 32px;
            color: var(--text-dark);
            margin-bottom: 16px;
        }

        .price-tag {
            background: var(--primary-color);
            color: var(--white);
            padding: 16px 32px;
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            margin-top: 24px;
        }

        .price-tag .amount {
            font-size: 36px;
            display: block;
        }

        .section-title {
            font-size: 24px;
            color: var(--text-dark);
            margin-bottom: 24px;
            text-align: center;
        }

        .quantity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }

        .quantity-btn {
            background: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 20px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .quantity-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .custom-quantity {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .btn-minus, .btn-plus {
            background: var(--primary-color);
            color: var(--white);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
        }

        #quantityInput {
            width: 120px;
            height: 48px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            border: 2px solid var(--border-color);
            border-radius: 8px;
        }

        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            z-index: 1000;
        }
        
        .selection-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .selection-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }
        
        .count {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .total {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        #bonusInfo {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .btn-buy {
            background: var(--secondary-color);
            color: var(--white);
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (max-width: 768px) {
            .action-bar {
                flex-direction: column;
                padding: 12px;
                gap: 12px;
            }
            
            .selection-info {
                width: 100%;
            }
            
            .btn-buy {
                width: 100%;
                padding: 14px;
                font-size: 15px;
            }
        }

        .btn-buy {
            background: var(--secondary-color);
            color: var(--white);
            border: none;
            padding: 16px 48px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-buy:hover {
            background: var(--secondary-dark);
        }

        .btn-buy:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--white);
            padding: 24px 20px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 32px;
            color: #94a3b8;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-close:hover {
            color: #64748b;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
            text-align: center;
        }

        .purchase-summary {
            background: #f8fafc;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 12px;
        }

        .summary-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 4px 0;
        }

        .summary-icon {
            font-size: 20px;
        }

        .summary-label {
            flex: 1;
            color: #64748b;
            font-size: 14px;
        }

        .summary-value {
            font-weight: 700;
            color: #1e293b;
            font-size: 16px;
        }

        .summary-price {
            color: #16a34a;
        }

        .form-group {
            margin-bottom: 12px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #64748b;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group input:read-only,
        .form-group input:disabled {
            background-color: #f1f5f9;
            cursor: not-allowed;
            color: #64748b;
        }

        #step1, #step2 {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .phone-input-wrapper {
            display: flex;
            align-items: center;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .phone-input-wrapper:focus-within {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .phone-prefix {
            background: #f8fafc;
            padding: 14px 16px;
            color: #64748b;
            font-weight: 600;
            border-right: 1px solid #e2e8f0;
            white-space: nowrap;
            font-size: 15px;
        }

        .phone-input-wrapper input {
            border: none;
            flex: 1;
            padding: 14px 16px;
        }

        .phone-input-wrapper input:focus {
            outline: none;
            box-shadow: none;
        }

        .btn-confirm-purchase {
            width: 100%;
            background: #f97316;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 4px;
            margin-bottom: 0;
        }

        .btn-confirm-purchase:hover {
            background: #ea580c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        .btn-confirm-purchase:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .modal-actions {
            margin-top: 24px;
            display: flex;
            gap: 12px;
        }

        .btn-cancel, .btn-confirm {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .btn-cancel {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-confirm {
            background: var(--secondary-color);
            color: var(--white);
        }
        
        .error-message {
            color: var(--primary-color);
            font-size: 14px;
            margin-top: 4px;
            display: none;
        }

        /* PIX Modal Specifics */
        #pixQrCode {
            max-width: 280px;
            margin: 20px auto;
            display: block;
        }

        #pixCopyPaste {
            width: 100%;
            padding: 12px;
            font-family: monospace;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 12px;
            word-break: break-all;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--secondary-color);
            margin: 20px auto;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: var(--secondary-color);
            stroke-miterlimit: 10;
            box-shadow: inset 0px 0px 0px var(--secondary-color);
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
            margin: 20px auto;
        }
        .success-checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: var(--secondary-color);
            fill: none;
            animation: stroke .6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .success-checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke .3s cubic-bezier(0.65, 0, 0.45, 1) .8s forwards;
        }
        @keyframes stroke {
            100% { stroke-dashoffset: 0; }
        }
        @keyframes scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }
        @keyframes fill {
            100% { box-shadow: inset 0px 0px 0px 40px var(--secondary-color); }
        }

        /* Referral Bonus Modal Styles */
        .referral-bonus-modal {
            max-width: 500px;
            text-align: center;
        }

        .referral-bonus-header {
            margin-bottom: 24px;
        }

        .bonus-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .referral-bonus-header h2 {
            color: var(--text-dark);
            font-size: 24px;
            margin: 0;
        }

        .referral-bonus-body {
            margin-bottom: 24px;
        }

        .bonus-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            color: white;
        }

        .bonus-number {
            font-size: 48px;
            font-weight: 700;
            display: block;
        }

        .bonus-text {
            font-size: 20px;
            font-weight: 600;
        }

        .bonus-description {
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .bonus-description strong {
            color: var(--primary-color);
            font-weight: 700;
        }

        .bonus-benefits {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
        }

        .benefit-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .benefit-icon {
            font-size: 28px;
            flex-shrink: 0;
        }
        
        .benefit-item strong {
            color: white;
            font-size: 16px;
        }
        
        .benefit-item span {
            font-size: 14px;
            line-height: 1.5;
        }

        .btn-close-bonus {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-close-bonus:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        /* How It Works Section */
        .how-it-works {
            display: grid;
            gap: 24px;
            margin-top: 24px;
        }

        .step-item {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .step-number {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
        }

        .step-content h4 {
            font-size: 18px;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .step-content p {
            color: var(--text-light);
            line-height: 1.6;
        }

        /* WhatsApp Support Section */
        .whatsapp-support {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: var(--white);
            text-align: center;
        }

        .support-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .support-icon {
            font-size: 64px;
        }

        .support-text h3 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--white);
        }

        .support-text p {
            font-size: 16px;
            opacity: 0.95;
        }

        .btn-whatsapp {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--white);
            color: #25D366;
            padding: 16px 32px;
            border-radius: 12px;
            text-decoration: none;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .step-item {
                flex-direction: column;
                text-align: center;
            }

            .step-number {
                margin: 0 auto;
            }
        }

        /* Premium Numbers Section */
        .premium-numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 8px;
            margin-top: 24px;
        }

        .premium-number-card {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border-radius: 6px;
            padding: 8px 6px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .premium-number-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .premium-number-card.premium-owned-special {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .premium-number-card.premium-won {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .premium-value-top {
            font-size: 13px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .premium-number {
            font-size: 16px;
            font-weight: 800;
            color: white;
            margin: 6px 0;
            letter-spacing: 0.5px;
        }

        .premium-number-struck {
            text-decoration: line-through;
            opacity: 0.8;
        }

        .premium-status {
            margin-top: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
        }

        .status-dot {
            color: white;
            font-size: 6px;
        }

        .status-text {
            font-size: 9px;
            color: white;
            font-weight: 500;
        }

        .status-owned-text {
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .premium-numbers-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 8px;
            }

            .premium-number-card {
                padding: 8px 6px;
            }

            .premium-number {
                font-size: 14px;
                margin: 6px 0;
            }

            .premium-value-top {
                font-size: 12px;
                margin-bottom: 4px;
            }

            .status-text {
                font-size: 9px;
            }

            .status-dot {
                font-size: 6px;
            }
        }


        .status-badge.status-locked {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .status-badge.status-won {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 11px;
        }

        @media (max-width: 768px) {
            .premium-numbers-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .premium-number {
                font-size: 28px;
            }

            .premium-value {
                font-size: 20px;
            }

            .modal-content {
                padding: 20px 16px;
                padding-bottom: 24px;
                max-height: 90vh;
            }
        }

    </style>
</head>
<body>
    <div class="header">
        <h1>{{ raffle.name }}</h1>
        <p>{{ raffle.prize_name }}</p>
    </div>

    <div class="container">
        <div class="main-card">
            <div class="prize-section">
                {% if raffle.prize_image_base64 %}
                <img src="{{ raffle.prize_image_base64 }}" alt="{{ raffle.prize_name }}" class="prize-image">
                {% else %}
                <div class="prize-image" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">üèÜ</div>
                {% endif %}
                <div class="prize-info">
                    <h2>{{ raffle.prize_name }}</h2>
                    <p>{{ raffle.description }}</p>
                    <div class="price-tag">
                        Por apenas <span class="amount">R$ {{ raffle.price_per_number }}</span> por n√∫mero
                    </div>
                </div>
            </div>
        </div>

        <!-- Bonus Section -->
        {% if raffle.enable_purchase_bonus or raffle.enable_milestone_bonus %}
        <div class="main-card" style="background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); border: none;">
            <h3 class="section-title" style="color: white;">üéÅ B√¥nus Especiais</h3>
            <div class="bonus-benefits">
                {% if raffle.enable_purchase_bonus %}
                <div class="benefit-item">
                    <div class="benefit-icon">üéØ</div>
                    <div>
                        <strong style="display: block; margin-bottom: 4px;">Ganhe N√∫meros Extras!</strong>
                        <span style="color: rgba(255,255,255,0.9);">A cada {{ raffle.purchase_bonus_every }} n√∫meros comprados, voc√™ ganha <strong>{{ raffle.purchase_bonus_amount }} n√∫mero{% if raffle.purchase_bonus_amount > 1 %}s{% endif %} gr√°tis</strong>!</span>
                    </div>
                </div>
                {% endif %}
                
                {% if raffle.enable_milestone_bonus %}
                <div class="benefit-item">
                    <div class="benefit-icon">üèÜ</div>
                    <div>
                        <strong style="display: block; margin-bottom: 4px;">{{ raffle.milestone_prize_name }}</strong>
                        <span style="color: rgba(255,255,255,0.9);">Compre {{ raffle.milestone_quantity }} n√∫meros ou mais e ganhe: <strong>{{ raffle.milestone_prize_description }}</strong></span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="numbers-section">
            <h3 class="section-title">Escolha a quantidade de n√∫meros</h3>
            <div class="quantity-grid">
                <button class="quantity-btn" onclick="selectQuantity(1)">+1</button>
                <button class="quantity-btn" onclick="selectQuantity(10)">+10</button>
                <button class="quantity-btn" onclick="selectQuantity(20)">+20</button>
                <button class="quantity-btn" onclick="selectQuantity(50)">+50</button>
                <button class="quantity-btn" onclick="selectQuantity(100)">+100</button>
                <button class="quantity-btn" onclick="selectQuantity(500)">+500</button>
            </div>
            <div class="quantity-grid" style="justify-content: center; margin-top: 8px;">
                <button class="quantity-btn" onclick="resetQuantity()" style="background-color: #6c757d;">Zerar</button>
            </div>
            <div class="custom-quantity">
                <button class="btn-minus" onclick="decreaseQuantity()">-</button>
                <input type="number" id="quantityInput" value="1" min="1" max="10000" onchange="updateQuantity()">
                <button class="btn-plus" onclick="increaseQuantity()">+</button>
            </div>
        </div>

        <!-- Premium Numbers Section -->
        {% if prize_numbers %}
        <div class="main-card">
            <h3 class="section-title">üéÅ Cotas Premiadas</h3>
            <p style="text-align: center; color: var(--text-light); margin-bottom: 24px;">
                Encontre e ganhe pr√™mios especiais! <span style="font-weight: 600;">{{ prize_numbers.count }}</span> cotas dispon√≠veis
            </p>
            <div class="premium-numbers-grid">
                {% for prize_number in prize_numbers %}
                <div class="premium-number-card {% if prize_number.is_won %}premium-won{% elif prize_number.number in user_numbers %}premium-owned-special{% else %}premium-available{% endif %}">
                    <div class="premium-value-top">R${{ prize_number.prize_amount|floatformat:0 }}</div>
                    <div class="premium-number {% if prize_number.is_won %}premium-number-struck{% endif %}">
                        {% widthratio raffle.total_numbers 1 1 as total_str %}
                        {% if raffle.total_numbers < 1000 %}
                            {{ prize_number.number|stringformat:"03d" }}
                        {% elif raffle.total_numbers < 10000 %}
                            {{ prize_number.number|stringformat:"04d" }}
                        {% elif raffle.total_numbers < 100000 %}
                            {{ prize_number.number|stringformat:"05d" }}
                        {% else %}
                            {{ prize_number.number|stringformat:"06d" }}
                        {% endif %}
                    </div>
                    <div class="premium-status">
                        {% if prize_number.is_won %}
                        <span class="status-text">{{ prize_number.winner.name }}</span>
                        {% elif prize_number.number in user_numbers %}
                        <span class="status-text status-owned-text">‚úì Voc√™ tem</span>
                        {% else %}
                        <span class="status-dot">‚óè</span> <span class="status-text">Dispon√≠vel</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Como Funciona Section -->
        <div class="main-card">
            <h3 class="section-title">üí° Como funciona?</h3>
            <div class="how-it-works">
                <div class="step-item">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Escolha seus n√∫meros</h4>
                        <p>Selecione a quantidade de n√∫meros que deseja participar. Quanto mais n√∫meros, maiores suas chances de ganhar!</p>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Fa√ßa seu pedido</h4>
                        <p>Preencha seus dados e reserve seus n√∫meros. Voc√™ receber√° todas as informa√ß√µes no WhatsApp.</p>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Realize o pagamento</h4>
                        <p>Pague via PIX de forma r√°pida e segura. Ap√≥s a confirma√ß√£o, seus n√∫meros estar√£o garantidos!</p>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Aguarde o sorteio</h4>
                        <p>Acompanhe tudo pelo WhatsApp e tor√ßa pela sorte! O sorteio √© transparente e seguro.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Suporte WhatsApp Section -->
        <div class="main-card whatsapp-support">
            <div class="support-content">
                <div class="support-icon">üí¨</div>
                <div class="support-text">
                    <h3>Precisa de ajuda?</h3>
                    <p>Entre em contato com nosso suporte pelo WhatsApp!</p>
                </div>
                <a href="https://wa.me/{{ admin_whatsapp }}?text=Ol√°!%20Preciso%20de%20ajuda%20com%20a%20campanha%20{{ raffle.name|urlencode }}" 
                   target="_blank" 
                   class="btn-whatsapp">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                    Falar no WhatsApp
                </a>
            </div>
        </div>
    </div>

    <div class="action-bar">
        <div class="selection-info">
            <div class="selection-summary">
                <div class="count"><span id="selectedCount">1</span> n√∫mero(s)</div>
                <div class="total">R$ <span id="totalAmount">{{ raffle.price_per_number }}</span></div>
            </div>
            <div id="bonusInfo"></div>
        </div>
        <button class="btn-buy" id="buyButton" onclick="openLoginModal()">Participar Agora</button>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>

            <!-- ETAPA 1: WhatsApp apenas -->
            <div id="step1" style="display: block;">
                <h3 class="modal-title">Finalize o cadastro</h3>

                <!-- Resumo da compra -->
                <div class="purchase-summary">
                    <div class="summary-row">
                        <span class="summary-icon">üéüÔ∏è</span>
                        <span class="summary-label">Quantidade de t√≠tulos</span>
                        <span class="summary-value" id="modalQuantity">1</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-icon">üí∞</span>
                        <span class="summary-label">Valor</span>
                        <span class="summary-value summary-price" id="modalTotal">R$ 0,19</span>
                    </div>
                </div>

                <!-- Benef√≠cios conquistados -->
                <div id="modalBonusStep1" style="margin-top: 8px;"></div>

                <form id="step1Form">
                    <div class="form-group">
                        <label for="whatsappInputStep1">Celular com DDD*</label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">üáßüá∑ +55</span>
                            <input type="tel" id="whatsappInputStep1" placeholder="(00) 00000-0000" required maxlength="15">
                        </div>
                        <div class="error-message" id="whatsappStep1Error"></div>
                    </div>

                    <button type="submit" class="btn-confirm-purchase" id="continueBtn">
                        Continuar ‚Üí
                    </button>
                </form>
            </div>

            <!-- ETAPA 2: Formul√°rio completo -->
            <div id="step2" style="display: none;">
                <h3 class="modal-title">Finalize o cadastro</h3>

                <!-- Mensagem de boas-vindas (aparece se usu√°rio existe) -->
                <div id="welcomeMessage" style="display: none; background: #f0fdf4; border: 1px solid #22c55e; border-radius: 6px; padding: 8px; margin-bottom: 12px; text-align: center;">
                    <p style="margin: 0; color: #15803d; font-weight: 600; font-size: 14px;">
                        Bem-vindo de volta, <span id="welcomeName"></span>! üéâ
                    </p>
                </div>

                <!-- Resumo da compra -->
                <div class="purchase-summary">
                    <div class="summary-row">
                        <span class="summary-icon">üéüÔ∏è</span>
                        <span class="summary-label">Quantidade de t√≠tulos</span>
                        <span class="summary-value" id="modalQuantity2">1</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-icon">üí∞</span>
                        <span class="summary-label">Valor</span>
                        <span class="summary-value summary-price" id="modalTotal2">R$ 0,19</span>
                    </div>
                </div>

                <!-- Benef√≠cios conquistados -->
                <div id="modalBonusStep2" style="margin-top: 8px;"></div>

                <form id="loginForm">
                    <div class="form-group">
                        <label for="nameInput">Nome Completo*</label>
                        <input type="text" id="nameInput" placeholder="Digite seu nome completo" required>
                        <div class="error-message" id="nameError"></div>
                    </div>

                    <div class="form-group">
                        <label for="whatsappInput">Celular com DDD*</label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">üáßüá∑ +55</span>
                            <input type="tel" id="whatsappInput" placeholder="(00) 00000-0000" required maxlength="15" readonly>
                        </div>
                        <div class="error-message" id="whatsappError"></div>
                    </div>

                    <div class="form-group">
                        <label for="whatsappConfirmInput">Confirmar celular*</label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">üáßüá∑ +55</span>
                            <input type="tel" id="whatsappConfirmInput" placeholder="(00) 00000-0000" required maxlength="15">
                        </div>
                        <div class="error-message" id="whatsappConfirmError"></div>
                    </div>

                    <!-- Mensagem de termos (sem checkbox) -->
                    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px; margin-bottom: 12px;">
                        <p style="margin: 0; font-size: 11px; color: #64748b; text-align: center; line-height: 1.4;">
                            Ao pagar confirmo ter lido os <a href="javascript:void(0)" onclick="openTermsModal()" style="color: #3b82f6; text-decoration: underline; font-weight: 500;">termos de uso</a>
                        </p>
                    </div>

                    <button type="submit" class="btn-confirm-purchase" id="confirmPurchaseBtn">
                        Cadastrar e pagar ‚Üí
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="pixModal">
        <div class="modal-content" id="pixModalContent">
            <!-- Content will be injected by JavaScript -->
        </div>
    </div>

    <!-- Referral Bonus Modal -->
    <div class="modal-overlay" id="referralBonusModal">
        <div class="modal-content referral-bonus-modal">
            <div class="referral-bonus-header">
                <div class="bonus-icon">üéÅ</div>
                <h2>Parab√©ns! Voc√™ ganhou um b√¥nus!</h2>
            </div>
            <div class="referral-bonus-body">
                <div class="bonus-highlight">
                    <span class="bonus-number" id="bonusAmount">{{ raffle.invitee_bonus }}</span>
                    <span class="bonus-text">n√∫mero{{ raffle.invitee_bonus|pluralize }} gr√°tis!</span>
                </div>
                <p class="bonus-description">
                    Voc√™ foi indicado por um amigo! Para receber seu{{ raffle.invitee_bonus|pluralize }} 
                    n√∫mero{{ raffle.invitee_bonus|pluralize }} b√¥nus, basta comprar 
                    <strong id="minPurchaseAmount">{{ raffle.invitee_min_purchase }}</strong> 
                    ou mais n√∫meros nesta campanha.
                </p>
                <div class="bonus-benefits">
                    <div class="benefit-item">
                        <span class="benefit-icon">‚úÖ</span>
                        <span>Mais chances de ganhar</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">‚úÖ</span>
                        <span>Totalmente gr√°tis</span>
                    </div>
                </div>
            </div>
            <button class="btn-close-bonus" onclick="closeReferralBonusModal()">
                Entendi, vamos l√°! üöÄ
            </button>
        </div>
    </div>

    <script>
        const config = {
            pricePerNumber: parseFloat("{{ raffle.price_per_number|stringformat:'.2f' }}"),
            raffleId: "{{ raffle.id }}",
            raffleName: "{{ raffle.name|escapejs }}",
            csrfToken: document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
            enableReferral: {{ raffle.enable_referral|yesno:"true,false" }},
            referralMinPurchase: {{ raffle.referral_min_purchase }},
            inviterBonus: {{ raffle.inviter_bonus }},
            inviteeBonus: {{ raffle.invitee_bonus }},
            inviteeMinPurchase: {{ raffle.invitee_min_purchase }},
            // Purchase bonus config
            enablePurchaseBonus: {{ raffle.enable_purchase_bonus|yesno:"true,false" }},
            purchaseBonusEvery: {{ raffle.purchase_bonus_every }},
            purchaseBonusAmount: {{ raffle.purchase_bonus_amount }},
            // Milestone bonus config
            enableMilestoneBonus: {{ raffle.enable_milestone_bonus|yesno:"true,false" }},
            milestoneQuantity: {{ raffle.milestone_quantity }},
            milestonePrizeName: "{{ raffle.milestone_prize_name|escapejs }}",
            milestonePrizeDescription: "{{ raffle.milestone_prize_description|escapejs }}"
        };

        let state = {
            currentQuantity: 1,
            accessToken: null,
            pollingInterval: null,
            timerInterval: null,
        };

        // --- UI Functions ---
        function selectQuantity(qty) {
            state.currentQuantity += qty;
            document.getElementById('quantityInput').value = state.currentQuantity;
            updateDisplay();
        }

        function resetQuantity() {
            state.currentQuantity = 1;
            document.getElementById('quantityInput').value = 1;
            updateDisplay();
        }

        function increaseQuantity() {
            document.getElementById('quantityInput').value++;
            updateQuantity();
        }

        function decreaseQuantity() {
            const input = document.getElementById('quantityInput');
            if (input.value > 1) {
                input.value--;
                updateQuantity();
            }
        }

        function updateQuantity() {
            const input = document.getElementById('quantityInput');
            state.currentQuantity = parseInt(input.value) || 1;
            if (state.currentQuantity < 1) state.currentQuantity = 1;
            input.value = state.currentQuantity;
            updateDisplay();
        }

        function formatCurrency(value) {
            return value.toFixed(2).replace('.', ',');
        }

        function updateDisplay() {
            const total = state.currentQuantity * config.pricePerNumber;
            document.getElementById('selectedCount').textContent = state.currentQuantity;
            document.getElementById('totalAmount').textContent = formatCurrency(total);
            
            // Calcular e exibir b√¥nus
            updateBonusDisplay();
        }
        
        function updateBonusDisplay() {
            const quantity = state.currentQuantity;
            let bonusHTML = '';
            
            // B√¥nus progressivo de compra
            if (config.enablePurchaseBonus && config.purchaseBonusEvery > 0) {
                const bonusCount = Math.floor(quantity / config.purchaseBonusEvery) * config.purchaseBonusAmount;
                if (bonusCount > 0) {
                    bonusHTML += `<div style="display: flex; align-items: center; gap: 6px; padding: 8px 10px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05)); border-radius: 8px; border: 1px solid rgba(34, 197, 94, 0.3);">
                        <span style="font-size: 16px;">üéÅ</span>
                        <span style="color: #16a34a; font-weight: 600; font-size: 13px;">+${bonusCount} n√∫mero${bonusCount > 1 ? 's' : ''} gr√°tis</span>
                    </div>`;
                }
            }
            
            // Pr√™mio milestone
            if (config.enableMilestoneBonus && quantity >= config.milestoneQuantity) {
                bonusHTML += `<div style="display: flex; align-items: center; gap: 6px; padding: 8px 10px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.05)); border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3);">
                    <span style="font-size: 16px;">üèÜ</span>
                    <div style="flex: 1;">
                        <div style="color: #d97706; font-weight: 600; font-size: 13px; line-height: 1.3;">${config.milestonePrizeName}</div>
                        <div style="color: #78716c; font-size: 11px; margin-top: 2px; line-height: 1.3;">${config.milestonePrizeDescription}</div>
                    </div>
                </div>`;
            }
            
            const bonusContainer = document.getElementById('bonusInfo');
            if (bonusContainer) {
                bonusContainer.innerHTML = bonusHTML;
            }
        }

        function updateModalBonusDisplay() {
            const quantity = state.currentQuantity;
            let bonusHTML = '';
            let hasBenefits = false;

            // B√¥nus progressivo de compra
            if (config.enablePurchaseBonus && config.purchaseBonusEvery > 0) {
                const bonusCount = Math.floor(quantity / config.purchaseBonusEvery) * config.purchaseBonusAmount;
                if (bonusCount > 0) {
                    hasBenefits = true;
                    bonusHTML += `<div style="display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05)); border-radius: 6px; border: 1px solid rgba(34, 197, 94, 0.3); margin-bottom: 6px;">
                        <span style="font-size: 16px;">üéÅ</span>
                        <span style="color: #16a34a; font-weight: 600; font-size: 13px;">+${bonusCount} t√≠tulo${bonusCount > 1 ? 's' : ''} b√¥nus</span>
                    </div>`;
                }
            }

            // Pr√™mio milestone
            if (config.enableMilestoneBonus && quantity >= config.milestoneQuantity) {
                hasBenefits = true;
                bonusHTML += `<div style="display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.05)); border-radius: 6px; border: 1px solid rgba(251, 191, 36, 0.3); margin-bottom: 6px;">
                    <span style="font-size: 16px;">üèÜ</span>
                    <div style="flex: 1;">
                        <div style="color: #d97706; font-weight: 600; font-size: 13px; line-height: 1.2;">${config.milestonePrizeName}</div>
                        <div style="color: #78716c; font-size: 11px; margin-top: 1px; line-height: 1.2;">${config.milestonePrizeDescription}</div>
                    </div>
                </div>`;
            }

            // Se houver benef√≠cios, adicionar t√≠tulo
            if (hasBenefits) {
                bonusHTML = `
                    <div style="background: #f8fafc; border-radius: 8px; padding: 8px 10px; border: 1px solid #e2e8f0;">
                        <div style="color: #475569; font-weight: 600; font-size: 12px; margin-bottom: 6px; display: flex; align-items: center; gap: 4px;">
                            <span>‚ú®</span>
                            <span>Benef√≠cios:</span>
                        </div>
                        ${bonusHTML}
                    </div>
                `;
            }

            // Atualizar ambos os steps
            const modalBonusStep1 = document.getElementById('modalBonusStep1');
            const modalBonusStep2 = document.getElementById('modalBonusStep2');

            if (modalBonusStep1) {
                modalBonusStep1.innerHTML = bonusHTML;
            }
            if (modalBonusStep2) {
                modalBonusStep2.innerHTML = bonusHTML;
            }
        }

        function openLoginModal() {
            // Validar quantidade m√≠nima
            if (!state.currentQuantity || state.currentQuantity < 1) {
                state.currentQuantity = 1;
            }

            console.log('Opening modal with quantity:', state.currentQuantity);

            // Resetar para etapa 1
            document.getElementById('step1').style.display = 'block';
            document.getElementById('step2').style.display = 'none';

            // Limpar campos
            document.getElementById('whatsappInputStep1').value = '';
            clearErrors();

            // Atualizar valores do resumo da compra no modal (ETAPA 1)
            const modalQtyElement = document.getElementById('modalQuantity');
            const modalTotalElement = document.getElementById('modalTotal');

            if (modalQtyElement && modalTotalElement) {
                modalQtyElement.textContent = state.currentQuantity;
                modalTotalElement.textContent = 'R$ ' + formatCurrency(state.currentQuantity * config.pricePerNumber);
            } else {
                console.error('Modal elements not found!');
            }

            // Atualizar benef√≠cios no modal
            updateModalBonusDisplay();

            openModal('loginModal');
        }

        // M√°scara para telefone brasileiro (XX) XXXXXXXXX
        function phoneMask(value) {
            value = value.replace(/\D/g, ''); // Remove tudo que n√£o √© d√≠gito
            
            if (value.length <= 10) {
                // (XX) XXXX-XXXX
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else {
                // (XX) XXXXX-XXXX
                value = value.replace(/^(\d{2})(\d{5})(\d{0,4}).*/, '($1) $2-$3');
            }
            
            return value;
        }

        // Aplicar m√°scara aos inputs de telefone
        const whatsappInput = document.getElementById('whatsappInput');
        const whatsappConfirmInput = document.getElementById('whatsappConfirmInput');
        const whatsappInputStep1 = document.getElementById('whatsappInputStep1');

        if (whatsappInput) {
            whatsappInput.addEventListener('input', function(e) {
                e.target.value = phoneMask(e.target.value);
            });
        }

        if (whatsappConfirmInput) {
            whatsappConfirmInput.addEventListener('input', function(e) {
                e.target.value = phoneMask(e.target.value);
            });
        }

        if (whatsappInputStep1) {
            whatsappInputStep1.addEventListener('input', function(e) {
                e.target.value = phoneMask(e.target.value);
            });
        }

        // C√≥digo do checkbox de termos removido - agora √© apenas informativo

        function openModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                console.log('Opening modal:', id);
                modal.classList.add('visible');
            } else {
                console.error('Modal not found:', id);
            }
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('visible');
            if (state.pollingInterval) {
                clearInterval(state.pollingInterval);
                state.pollingInterval = null;
            }
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
        }

        function setButtonLoading(button, isLoading, text = 'Aguarde...') {
            button.disabled = isLoading;
            button.textContent = isLoading ? text : button.dataset.originalText;
        }

        function displayError(field, message) {
            const errorElement = document.getElementById(`${field}Error`);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
        }

        // --- Step 1 Form Handler (WhatsApp Check) ---
        document.getElementById('step1Form').addEventListener('submit', async function(event) {
            event.preventDefault();
            clearErrors();

            const continueBtn = document.getElementById('continueBtn');
            continueBtn.dataset.originalText = continueBtn.textContent;
            setButtonLoading(continueBtn, true, 'Verificando...');

            const whatsappRaw = document.getElementById('whatsappInputStep1').value;
            const whatsappClean = whatsappRaw.replace(/\D/g, '');

            // Validar formato
            if (whatsappClean.length < 10) {
                displayError('whatsappStep1', 'Digite um n√∫mero v√°lido com DDD');
                setButtonLoading(continueBtn, false);
                return;
            }

            try {
                // Verificar se WhatsApp existe
                const response = await fetch('/api/auth/check-whatsapp/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': config.csrfToken
                    },
                    body: JSON.stringify({ whatsapp: whatsappClean })
                });

                const data = await response.json();

                // Transi√ß√£o para ETAPA 2
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';

                // Atualizar resumo da compra na ETAPA 2
                document.getElementById('modalQuantity2').textContent = state.currentQuantity;
                document.getElementById('modalTotal2').textContent = 'R$ ' + formatCurrency(state.currentQuantity * config.pricePerNumber);

                // Atualizar benef√≠cios no modal (j√° foi calculado no Step 1)
                updateModalBonusDisplay();

                // Preencher campo de WhatsApp na ETAPA 2
                document.getElementById('whatsappInput').value = whatsappRaw;
                document.getElementById('whatsappInput').readOnly = true;

                if (data.exists && data.user) {
                    // ETAPA 2A: Usu√°rio existente
                    document.getElementById('welcomeMessage').style.display = 'block';
                    document.getElementById('welcomeName').textContent = data.user.name;

                    // Preencher campos com dados do usu√°rio (readonly)
                    document.getElementById('nameInput').value = data.user.name;
                    document.getElementById('nameInput').readOnly = true;

                    // Auto-preencher confirma√ß√£o de telefone
                    document.getElementById('whatsappConfirmInput').value = whatsappRaw;
                    document.getElementById('whatsappConfirmInput').readOnly = true;
                } else {
                    // ETAPA 2B: Novo usu√°rio
                    document.getElementById('welcomeMessage').style.display = 'none';

                    // Limpar e habilitar campos
                    document.getElementById('nameInput').value = '';
                    document.getElementById('nameInput').readOnly = false;

                    // Auto-preencher telefone com WhatsApp, mas permitir edi√ß√£o da confirma√ß√£o
                    document.getElementById('whatsappConfirmInput').value = '';
                    document.getElementById('whatsappConfirmInput').readOnly = false;
                }

            } catch (error) {
                console.error('WhatsApp check error:', error);
                displayError('whatsappStep1', 'Erro ao verificar WhatsApp. Tente novamente.');
            } finally {
                setButtonLoading(continueBtn, false);
            }
        });

        // --- Purchase Logic ---
        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            clearErrors();

            const confirmBtn = document.getElementById('confirmPurchaseBtn');
            confirmBtn.dataset.originalText = confirmBtn.textContent;

            setButtonLoading(confirmBtn, true);

            // Obter valores e limpar formata√ß√£o do telefone
            const whatsappRaw = document.getElementById('whatsappInput').value;
            const whatsappConfirmRaw = document.getElementById('whatsappConfirmInput').value;

            // Remover formata√ß√£o para compara√ß√£o e envio
            const whatsappClean = whatsappRaw.replace(/\D/g, '');
            const whatsappConfirmClean = whatsappConfirmRaw.replace(/\D/g, '');

            const userData = {
                name: document.getElementById('nameInput').value,
                whatsapp: whatsappClean  // Enviar apenas n√∫meros
            };

            // Valida√ß√£o b√°sica
            if (!userData.name || !userData.whatsapp) {
                displayError('whatsapp', 'Nome e telefone s√£o obrigat√≥rios.');
                setButtonLoading(confirmBtn, false);
                return;
            }

            // Valida√ß√£o de confirma√ß√£o do telefone (comparar sem formata√ß√£o)
            if (whatsappClean !== whatsappConfirmClean) {
                displayError('whatsappConfirm', 'Os n√∫meros de telefone n√£o coincidem.');
                setButtonLoading(confirmBtn, false);
                return;
            }

            try {
                const response = await authenticateUser(userData);
                
                // A resposta tem estrutura: { user: {...}, tokens: { access, refresh }, created: bool }
                state.accessToken = response.tokens.access;
                
                console.log('Authentication successful, token:', state.accessToken ? 'SET' : 'NOT SET');

                const order = await createRaffleOrder(state.currentQuantity);
                const pixData = await createPixPayment(order.id);

                closeModal('loginModal');
                showPixModal(pixData, order.id);

            } catch (error) {
                console.error('Purchase process error:', error);
                let errorMessage = 'Ocorreu um erro. Tente novamente.';
                
                // Tentar extrair mensagem de erro do objeto
                if (error.message) {
                    try {
                        const errorObj = JSON.parse(error.message);
                        errorMessage = errorObj.detail || errorObj.error || error.message;
                    } catch (e) {
                        errorMessage = error.message;
                    }
                }
                
                displayError('whatsapp', errorMessage);
            } finally {
                setButtonLoading(confirmBtn, false);
            }
        });

        function showPixModal(pixData, orderId) {
            const modalContent = document.getElementById('pixModalContent');
            modalContent.innerHTML = `
                <h3 class="modal-title">Pague com PIX para garantir seus n√∫meros</h3>
                
                <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #856404; font-size: 14px;">
                        ‚è±Ô∏è Tempo restante: <strong><span id="timer">15:00</span></strong>
                    </p>
                    <p style="margin: 5px 0 0 0; color: #856404; font-size: 12px;">
                        Ap√≥s esse tempo, os n√∫meros ser√£o liberados.
                    </p>
                </div>
                
                <img src="data:image/png;base64,${pixData.qr_code_base64}" alt="PIX QR Code" id="pixQrCode">
                <p>Ou copie o c√≥digo abaixo:</p>
                <input type="text" id="pixCopyPaste" value="${pixData.qr_code}" readonly>
                <button class="btn-confirm" onclick="copyPixCode()">Copiar C√≥digo</button>
                <div id="paymentStatus">
                    <div class="spinner"></div>
                    <p>Aguardando confirma√ß√£o do pagamento...</p>
                </div>
            `;
            openModal('pixModal');
            startTimer(900); // 15 minutos = 900 segundos
            startPolling(orderId);
        }

        function startTimer(seconds) {
            let remaining = seconds;
            const timerElement = document.getElementById('timer');
            
            state.timerInterval = setInterval(() => {
                const minutes = Math.floor(remaining / 60);
                const secs = remaining % 60;
                timerElement.textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
                
                remaining--;
                
                if (remaining < 0) {
                    clearInterval(state.timerInterval);
                    clearInterval(state.pollingInterval);
                    showExpired();
                }
            }, 1000);
        }

        function showExpired() {
            const modalContent = document.getElementById('pixModalContent');
            modalContent.innerHTML = `
                <h3 class="modal-title" style="color: #dc2626;">‚è∞ Tempo Esgotado</h3>
                <p style="text-align: center; margin: 30px 0;">
                    O tempo para pagamento expirou e os n√∫meros foram liberados.
                </p>
                <button class="btn-confirm" onclick="location.reload()">Tentar Novamente</button>
            `;
        }

        function startPolling(orderId) {
            state.pollingInterval = setInterval(async () => {
                try {
                    const statusData = await checkOrderStatus(orderId);
                    console.log('üìä Status data:', statusData);
                    if (statusData.status === 'paid') {
                        clearInterval(state.pollingInterval);
                        clearInterval(state.timerInterval);
                        console.log('üèÜ Won prizes:', statusData.won_prizes);
                        showSuccess(orderId, statusData.won_prizes);
                    }
                } catch (error) {
                    console.error('Polling error:', error);
                    clearInterval(state.pollingInterval);
                }
            }, 5000); // Check every 5 seconds
        }

        async function showSuccess(orderId, wonPrizes = []) {
            const modalContent = document.getElementById('pixModalContent');
            
            console.log('üéâ Showing success with prizes:', wonPrizes);

            // Buscar detalhes do pedido com os n√∫meros
            let numbers = [];
            let quantity = 0;
            try {
                const orderData = await getOrderDetails(orderId);
                numbers = orderData.numbers || [];
                quantity = orderData.quantity || numbers.length;
            } catch (error) {
                console.error('Error fetching order details:', error);
            }
            
            // Criar Set com n√∫meros premiados para f√°cil lookup
            const prizeNumbers = new Set(wonPrizes?.map(p => p.number) || []);

            // HTML para exibir pr√™mios ganhos - POSI√á√ÉO DESTACADA NO TOPO
            const prizesHTML = wonPrizes && wonPrizes.length > 0
                ? `<div style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border: 3px solid #fbbf24; border-radius: 16px; padding: 25px; margin: 20px 0; box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3); animation: prize-pulse 1.5s infinite;">
                       <div style="text-align: center; margin-bottom: 15px;">
                           <div style="font-size: 56px; margin-bottom: 10px; animation: trophy-bounce 1s infinite;">üèÜ</div>
                           <h3 style="margin: 0; color: white; font-size: 28px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); font-weight: bold;">üéä PARAB√âNS! VOC√ä GANHOU! üéä</h3>
                       </div>
                       ${wonPrizes.map(prize => `
                           <div style="background: white; border-radius: 12px; padding: 20px; margin: 15px 0; box-shadow: 0 4px 8px rgba(0,0,0,0.15);">
                               <div style="text-align: center;">
                                   <p style="margin: 0 0 10px 0; color: #78350f; font-size: 18px; font-weight: 600;">üéÅ N√∫mero Premiado:</p>
                                   <div style="display: inline-block; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; padding: 15px 30px; border-radius: 12px; font-weight: bold; font-size: 36px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                                       ${String(prize.number).padStart(4, '0')}
                                   </div>
                                   <p style="margin: 15px 0 0 0; color: #15803d; font-size: 32px; font-weight: bold;">
                                       üí∞ ${prize.prize_amount_formatted}
                                   </p>
                                   <p style="margin: 10px 0 0 0; color: #64748b; font-size: 16px; font-weight: 500;">
                                       ü§ë O pr√™mio ser√° enviado via PIX em at√© 24h!
                                   </p>
                               </div>
                           </div>
                       `).join('')}
                   </div>
                   <style>
                       @keyframes prize-pulse {
                           0%, 100% { transform: scale(1); box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3); }
                           50% { transform: scale(1.02); box-shadow: 0 12px 24px rgba(251, 191, 36, 0.5); }
                       }
                       @keyframes trophy-bounce {
                           0%, 100% { transform: translateY(0); }
                           50% { transform: translateY(-10px); }
                       }
                   </style>`
                : '';

            const numbersHTML = numbers.length > 0
                ? `<div style="background: #f0fdf4; border: 2px solid #22c55e; border-radius: 12px; padding: 20px; margin: 20px 0;">
                       <h4 style="margin: 0 0 15px 0; color: #15803d;">üéâ Seus N√∫meros da Sorte:</h4>
                       <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                           ${numbers.map(n => {
                               const isPrize = prizeNumbers.has(n);
                               const baseStyle = "padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 18px;";
                               const style = isPrize 
                                   ? baseStyle + " background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; border: 2px solid #f59e0b; box-shadow: 0 4px 8px rgba(251, 191, 36, 0.5); animation: number-glow 1.5s infinite;"
                                   : baseStyle + " background: #22c55e; color: white;";
                               return `<span style="${style}">${String(n).padStart(4, '0')}${isPrize ? ' üèÜ' : ''}</span>`;
                           }).join('')}
                       </div>
                   </div>
                   <style>
                       @keyframes number-glow {
                           0%, 100% { box-shadow: 0 4px 8px rgba(251, 191, 36, 0.5); }
                           50% { box-shadow: 0 4px 16px rgba(251, 191, 36, 0.8); }
                       }
                   </style>`
                : '';

            // Buscar c√≥digo de indica√ß√£o do usu√°rio
            let referralHTML = '';
            if (config.enableReferral && quantity >= config.referralMinPurchase) {
                try {
                    const response = await fetch(`/api/raffles/${config.raffleId}/my-referral/`, {
                        headers: {
                            'Authorization': `Bearer ${state.accessToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    const referralData = await response.json();

                    if (referralData.has_referral) {
                        let progressiveBonus = '';
                        if (referralData.enable_progressive_bonus) {
                            progressiveBonus = `<p style="margin: 5px 0 15px 0; font-size: 12px; opacity: 0.9; background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px;">
                                üìà <strong>B√¥nus Progressivo:</strong> +1 n√∫mero a cada ${referralData.progressive_bonus_every} que seu amigo comprar!
                            </p>`;
                        }
                        
                        referralHTML = `
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; margin: 20px 0; color: white; text-align: center;">
                                <h4 style="margin: 0 0 10px 0; font-size: 20px;">üéÅ Ganhe ${referralData.inviter_bonus} N√∫meros Gr√°tis!</h4>
                                <p style="margin: 0 0 10px 0; font-size: 14px;">Indique um amigo e voc√™s dois ganham n√∫meros extras!</p>
                                <p style="margin: 0 0 10px 0; font-size: 12px; opacity: 0.9;">Voc√™ ganha ${referralData.inviter_bonus} e seu amigo ganha ${referralData.invitee_bonus} n√∫meros</p>
                                ${progressiveBonus}

                                <div style="background: rgba(255,255,255,0.15); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                                    <input
                                        id="referralLink"
                                        type="text"
                                        value="${referralData.link}"
                                        readonly
                                        style="width: 100%; padding: 10px; border: none; border-radius: 6px; font-size: 13px; text-align: center;"
                                    >
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: center;">
                                    <button onclick="copyReferralLink('${referralData.link}')" style="background: white; color: #667eea; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; flex: 1; max-width: 150px;">
                                        üìã Copiar Link
                                    </button>
                                    <button onclick="shareReferral('${referralData.link}')" style="background: white; color: #667eea; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; flex: 1; max-width: 150px;">
                                        üì§ Compartilhar
                                    </button>
                                </div>

                                <p style="margin: 15px 0 0 0; font-size: 11px; opacity: 0.8;">
                                    ${referralData.clicks} cliques ‚Ä¢ ${referralData.successful_referrals} indica√ß√µes bem-sucedidas
                                </p>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Error fetching referral:', error);
                }
            }

            modalContent.innerHTML = `
                <div class="success-checkmark">
                    <svg class="success-checkmark__circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle cx="26" cy="26" r="25" fill="none"/>
                    </svg>
                    <svg class="success-checkmark__check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <path fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                </div>
                <h3 class="modal-title">Pagamento Aprovado!</h3>
                <p>Seus n√∫meros foram garantidos e enviados para seu WhatsApp.</p>

                ${prizesHTML}
                ${numbersHTML}
                ${referralHTML}

                <div class="modal-actions">
                    <button class="btn-confirm" onclick="closeModal('pixModal'); location.reload()">Fechar</button>
                </div>
            `;
        }
        
        function copyReferralLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                alert('‚úÖ Link copiado! Compartilhe com seus amigos para ganhar n√∫meros gr√°tis üéâ');
            }).catch(err => {
                console.error('Error copying:', err);
                // Fallback para navegadores mais antigos
                const input = document.getElementById('referralLink');
                if (input) {
                    input.select();
                    document.execCommand('copy');
                    alert('‚úÖ Link copiado!');
                }
            });
        }

        function shareReferral(url) {
            const text = `üéâ Participe desta rifa incr√≠vel e concorra a pr√™mios! Use meu link e ganhe ${config.inviteeBonus} n√∫meros gr√°tis: ${url}`;

            if (navigator.share) {
                navigator.share({
                    title: 'Participe da Rifa',
                    text: text,
                    url: url
                }).catch(err => console.log('Error sharing:', err));
            } else {
                // Fallback: copiar para clipboard
                navigator.clipboard.writeText(text).then(() => {
                    alert('Link copiado! Compartilhe com seus amigos üéâ');
                });
            }
        }

        function copyPixCode() {
            const input = document.getElementById('pixCopyPaste');
            input.select();
            document.execCommand('copy');
            const btn = event.target;
            btn.textContent = 'Copiado!';
            setTimeout(() => { btn.textContent = 'Copiar C√≥digo'; }, 2000);
        }

        // --- API Functions ---
        async function apiFetch(url, method, body) {
            const headers = {
                'Content-Type': 'application/json',
                'X-CSRFToken': config.csrfToken,
            };
            if (state.accessToken) {
                headers['Authorization'] = `Bearer ${state.accessToken}`;
            }

            const response = await fetch(url, {
                method: method,
                headers: headers,
                body: body ? JSON.stringify(body) : null,
            });

            if (!response.ok) {
                // Clone response to read body multiple times if needed
                const responseClone = response.clone();
                
                // Try to parse JSON error first
                try {
                    const errorData = await response.json();
                    throw new Error(JSON.stringify(errorData));
                } catch (e) {
                    // If JSON parsing fails, read as text from the clone
                    try {
                        const text = await responseClone.text();
                        const safe = { error: text || response.statusText || 'Erro desconhecido' };
                        throw new Error(JSON.stringify(safe));
                    } catch (textError) {
                        // If everything fails, use status text
                        throw new Error(JSON.stringify({ error: response.statusText || 'Erro desconhecido' }));
                    }
                }
            }

            // Try to parse successful JSON response, but handle empty bodies gracefully
            try {
                return await response.json();
            } catch (e) {
                // No JSON content ‚Äî return empty object
                return {};
            }
        }

        async function authenticateUser(userData) {
            return await apiFetch('/api/auth/login/', 'POST', userData);
        }

        async function createRaffleOrder(quantity) {
            const data = { 
                raffle: config.raffleId, 
                quantity: quantity, 
                payment_method: 'mercadopago' 
            };
            
            // Capture referral code from URL if present
            const urlParams = new URLSearchParams(window.location.search);
            const referralCode = urlParams.get('ref');
            if (referralCode) {
                data.referral_code = referralCode;
                console.log('üéÅ Using referral code:', referralCode);
            }
            
            return await apiFetch(`/api/raffles/${config.raffleId}/buy/`, 'POST', data);
        }

        async function createPixPayment(orderId) {
            return await apiFetch('/api/payments/mercadopago/create/', 'POST', { order_id: orderId });
        }

        async function checkOrderStatus(orderId) {
            return await apiFetch(`/api/payments/status/${orderId}/`, 'GET');
        }

        async function getOrderDetails(orderId) {
            return await apiFetch(`/api/raffles/orders/${orderId}/`, 'GET');
        }

        // --- Referral Bonus Modal Functions ---
        function showReferralBonusModal() {
            const modal = document.getElementById('referralBonusModal');
            modal.classList.add('visible');
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeReferralBonusModal() {
            const modal = document.getElementById('referralBonusModal');
            modal.classList.remove('visible');
            // Restore body scroll
            document.body.style.overflow = '';
        }

        function checkReferralCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const referralCode = urlParams.get('ref');
            
            if (referralCode && config.enableReferral) {
                // Check if user has already seen this modal for this session
                const modalShown = sessionStorage.getItem(`referral_modal_${referralCode}`);
                if (!modalShown) {
                    // Show modal after a short delay for better UX
                    setTimeout(() => {
                        showReferralBonusModal();
                        sessionStorage.setItem(`referral_modal_${referralCode}`, 'true');
                    }, 1000);
                }
            }
        }

        // --- Init ---
        updateDisplay();
        checkReferralCode();

    </script>

    <!-- Footer -->
    <footer style="background: #1e293b; color: #94a3b8; padding: 32px 20px; text-align: center; margin-top: 80px;">
        <div style="max-width: 600px; margin: 0 auto;">
            <p style="margin-bottom: 16px; font-size: 14px;">{{ raffle.name }} ¬© 2025 - Todos os direitos reservados</p>
            <button onclick="openTermsModal()" style="background: transparent; border: none; color: #60a5fa; text-decoration: underline; cursor: pointer; font-size: 14px; padding: 8px 16px;">
                Termos e Condi√ß√µes
            </button>
        </div>
    </footer>

    <!-- Terms Modal -->
    <div class="modal-overlay" id="termsModal">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh; overflow-y: auto;">
            <button class="modal-close" onclick="closeModal('termsModal')">&times;</button>
            <h3 class="modal-title" style="font-size: 24px; margin-bottom: 8px;">üìã Termos e Condi√ß√µes</h3>
            <p style="color: #6b7280; margin-bottom: 24px; font-size: 14px;">Leia atentamente antes de participar</p>
            
            <div style="text-align: left;">
                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">1</span>
                        Elegibilidade para Participa√ß√£o
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        Para participar de nossas campanhas promocionais, √© necess√°rio ter no m√≠nimo 18 anos de idade. Esta √© uma exig√™ncia legal que visa proteger menores de idade e garantir a responsabilidade dos participantes.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">2</span>
                        Prorroga√ß√£o de Campanhas
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        Reservamo-nos o direito de estender o prazo de uma campanha caso a totalidade dos n√∫meros dispon√≠veis n√£o tenha sido comercializada. Al√©m disso, investiga√ß√µes de seguran√ßa ou verifica√ß√µes de integridade podem resultar em prorroga√ß√£o tempor√°ria.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">3</span>
                        Identifica√ß√£o do Vencedor
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        O vencedor ser√° determinado exclusivamente pelos dados registrados no n√∫mero sorteado: nome completo, CPF e telefone de contato. Estes dados devem estar corretos e atualizados.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">4</span>
                        Cancelamento de A√ß√µes
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        Campanhas podem ser interrompidas imediatamente caso sejam identificadas viola√ß√µes dos termos estabelecidos, atividades fraudulentas ou comportamentos que comprometam a integridade do processo.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">5</span>
                        Pol√≠tica de Reembolso
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        Reembolsos s√£o processados exclusivamente em caso de cancelamento oficial da campanha. Para pagamentos duplicados sem registro de dados, o solicitante deve apresentar comprovante de pagamento para an√°lise e posterior devolu√ß√£o dos valores.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">6</span>
                        Atualiza√ß√µes dos Termos
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        Estes termos podem ser modificados a qualquer momento para aprimoramento da experi√™ncia do usu√°rio, corre√ß√£o de inconsist√™ncias ou adequa√ß√£o a novas regulamenta√ß√µes. Recomendamos verifica√ß√£o peri√≥dica.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">7</span>
                        Entrega de Pr√™mios
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        As condi√ß√µes de entrega do pr√™mio ser√£o informadas diretamente ao contemplado ap√≥s o sorteio.
                    </p>
                </div>

                <div style="margin-bottom: 32px;">
                    <h4 style="color: #1e40af; font-size: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dbeafe; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700;">8</span>
                        Responsabilidade do Pagamento
                    </h4>
                    <p style="color: #4b5563; line-height: 1.6; font-size: 15px;">
                        Independentemente de quem efetuar o pagamento, ser√° reconhecido como participante v√°lido apenas a pessoa cujos dados pessoais est√£o registrados no n√∫mero adquirido.
                    </p>
                </div>
            </div>

            <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                <p style="color: #6b7280; font-size: 13px; text-align: center;">
                    D√∫vidas sobre estes termos? Entre em contato conosco pelo WhatsApp.
                </p>
            </div>
        </div>
    </div>

    <script>
        function openTermsModal() {
            openModal('termsModal');
        }
    </script>
</body>
</html>
